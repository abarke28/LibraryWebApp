@model LibraryWebApp.Models.Rental
@{
    ViewData["Title"] = "New Rental Form";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>New</h1>

<form>
    <div class="form-group">
        <label>Reader</label><br />
        <input id="readers" type="text" class="typeahead" placeholder="Reader..." />
    </div>
    <div class="form-group" id="typeahead">
        <label>Book</label><br />
        <input id="books" type="text" class="typeahead" placeholder="Book..."/>
    </div>

    <ul id="booksList" class="list-group"></ul>

    <button class="btn btn-primary">Submit</button>
</form>

@section Scripts
{ 
<script>
    $(document).ready(function () {
        var vm = {
            readerId: '',
            bookIds: []
        };

        var readers = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace('name'),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            prefetch: '/api/readers',
            remote: {
                url: '/api/readers?query=%QUERY',
                wildcard: '%QUERY'
            }
        });

        var books = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace('title'),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            prefetch: '/api/books',
            remote: {
                url: '/api/books?query=%QUERY',
                wildcard: '%QUERY'
            }
        });

        $('#readers').typeahead({
            minlength: 0,
            highlight: true
        }, {
            name: 'readers',
            display: 'name',
            source: readers
        }).on("typeahead:select", function (e, reader) {
            console.log(reader.name);
            vm.readerId = reader.id;
            });

        $('#books').typeahead({
            minlength: 0,
            highlight: true
        }, {
            name: 'books',
            display: 'title',
            source: books
        }).on('typeahead:select', function (e, book) {
            console.log(book.title);

            $('#booksList').append("<li>" + book.title + "</li>");
            $('#books').typeahead('val', '');

            vm.bookIds.push(book.id);
        });
    });
</script>
}